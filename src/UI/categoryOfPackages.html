<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Package Categories</title>-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->

<!--    &lt;!&ndash; Bootstrap & jQuery &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">-->
<!--    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->

<!--    <style>-->
<!--        body {-->
<!--            font-family: 'Poppins', sans-serif;-->
<!--            background-color: #F8FAFC;-->
<!--        }-->

<!--        .category-buttons {-->
<!--            text-align: center;-->
<!--            margin-top: 30px;-->
<!--        }-->

<!--        .category-buttons button {-->
<!--            margin: 5px;-->
<!--            padding: 10px 20px;-->
<!--            border-radius: 25px;-->
<!--            border: none;-->
<!--            background-color: #0a7567;-->
<!--            color: white;-->
<!--            font-weight: bold;-->
<!--            transition: background 0.3s;-->
<!--        }-->

<!--        .category-buttons button:hover {-->
<!--            background-color: #0EAF9AFF;-->
<!--        }-->

<!--        .package-card {-->
<!--            background: #fff;-->
<!--            border-radius: 15px;-->
<!--            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            transition: 0.3s;-->
<!--        }-->

<!--        .package-card:hover {-->
<!--            transform: translateY(-5px);-->
<!--        }-->

<!--        .package-title {-->
<!--            background: #E0ECFF;-->
<!--            color: #2563EB;-->
<!--            display: inline-block;-->
<!--            padding: 8px 15px;-->
<!--            border-radius: 8px;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        .package-price {-->
<!--            font-size: 24px;-->
<!--            font-weight: bold;-->
<!--            margin-top: 10px;-->
<!--        }-->

<!--        .package-features {-->
<!--            list-style: none;-->
<!--            padding: 0;-->
<!--            text-align: left;-->
<!--            margin-top: 15px;-->
<!--        }-->

<!--        .promo-badge {-->
<!--            color: #F44336;-->
<!--            font-weight: bold;-->
<!--            margin-top: 15px;-->
<!--        }-->

<!--        .btn-package {-->
<!--            background: #E40046;-->
<!--            color: #fff;-->
<!--            font-weight: bold;-->
<!--            padding: 10px 20px;-->
<!--            border-radius: 25px;-->
<!--            border: none;-->
<!--            transition: 0.3s;-->
<!--        }-->

<!--        .btn-package:hover {-->
<!--            background: #B30037;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<div class="container">-->
<!--    <h1 class="text-center mt-4">Select a Package Category</h1>-->

<!--    &lt;!&ndash; Category Buttons &ndash;&gt;-->
<!--    <div class="category-buttons">-->
<!--        <button onclick="loadPackages('Daily Renewal')">Daily Renewal</button>-->
<!--        <button onclick="loadPackages('Nonstop SD Plans')">Nonstop SD Plans</button>-->
<!--        <button onclick="loadPackages('Anytime Data Plans')">Anytime Data Plans</button>-->
<!--        <button onclick="loadPackages('Anytime Combo Plans')">Anytime Combo Plans</button>-->
<!--        <button onclick="loadPackages('Work & Learn')">Work & Learn</button>-->
<!--        <button onclick="loadPackages('Work From Home')">Work From Home</button>-->
<!--        <button onclick="loadPackages('Social Media')">Social Media</button>-->
<!--        <button onclick="loadPackages('Streaming')">Streaming</button>-->
<!--    </div>-->

<!--    &lt;!&ndash; Package Cards &ndash;&gt;-->
<!--    <section class="packages-section py-5">-->
<!--        <div class="container">-->
<!--            <div class="row" id="packageList">-->
<!--                &lt;!&ndash; Cards will be inserted here &ndash;&gt;-->
<!--                <div id="placeholderContent" class="text-center">-->
<!--                    <img src="assets/img/hero-carousel-1.jpg" width="1000px" alt="Select a category" class="mb-4">-->
<!--                    <h4 class="text-muted">Select a category to explore available packages</h4>-->
<!--                </div>-->

<!--            </div>-->
<!--        </div>-->
<!--    </section>-->
<!--</div>-->

<!--<script>-->
<!--    function loadPackages(category) {-->
<!--        let authToken = localStorage.getItem("authToken");-->

<!--        if (!authToken) {-->
<!--            alert("Unauthorized access. Please log in.");-->
<!--            window.location.href = "login.html";-->
<!--            return;-->
<!--        }-->

<!--        $.ajax({-->
<!--            url: `http://localhost:8080/api/v1/packages/getByType/${encodeURIComponent(category)}`,-->
<!--            type: "GET",-->
<!--            headers: { "Authorization": `Bearer ${authToken}` },-->
<!--            success: function (response) {-->
<!--                $("#packageList").empty(); // Clear previous content-->
<!--                if (!Array.isArray(response.data) || response.data.length === 0) {-->
<!--                    $("#packageList").html('<div class="text-center text-muted">No packages found for this category.</div>');-->
<!--                    return;-->
<!--                }-->

<!--                response.data.forEach(pkg => {-->
<!--                    $("#packageList").append(`-->
<!--            <div class="col-md-4 mb-4">-->
<!--                <div class="package-card">-->
<!--                    <div class="package-title">${pkg.packageName.toUpperCase()}</div>-->
<!--                    <div class="package-price">Rs. ${pkg.price.toFixed(2)}</div>-->
<!--                    <p class="text-muted">Per Month (Tax applicable)</p>-->
<!--                    <h5 class="mt-3">Unlimited</h5>-->
<!--                    <small class="text-muted">AnyNet Voice</small>-->
<!--                    <ul class="package-features">-->
<!--                        <li>ðŸ“© ${pkg.smsLimit || 1000} SMS</li>-->
<!--                        <li>ðŸ“¶ ${pkg.dataLimit ?? 'N/A'} GB With Data Rollover</li>-->
<!--                    </ul>-->
<!--                    <div class="promo-badge">ðŸ”¥ Special promotion</div>-->
<!--                    <button class="btn btn-package w-100 mt-3" onclick="activatePackage('${pkg.packageId}', ${pkg.price})">GET PACKAGE</button>-->
<!--                </div>-->
<!--            </div>-->
<!--        `);-->
<!--                });-->
<!--            },-->

<!--            error: function () {-->
<!--                alert("Failed to fetch packages.");-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--    function activatePackage(packageId, price) {-->
<!--        window.location.href = `getPackage.html?packageId=${packageId}&price=${price}`;-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Package Categories</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap & jQuery -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8FAFC;
        }

        .category-buttons {
            text-align: center;
            margin-top: 30px;
        }

        .category-buttons button {
            margin: 5px;
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            background-color: #0a7567;
            color: white;
            font-weight: bold;
            transition: background 0.3s;
        }

        .category-buttons button:hover {
            background-color: #0EAF9AFF;
        }

        .package-card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: 0.3s;
        }

        .package-card:hover {
            transform: translateY(-5px);
        }

        .package-title {
            background: #E0ECFF;
            color: #2563EB;
            display: inline-block;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .package-price {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }

        .package-features {
            list-style: none;
            padding: 0;
            text-align: left;
            margin-top: 15px;
        }

        .promo-badge {
            color: #F44336;
            font-weight: bold;
            margin-top: 15px;
        }

        .btn-package {
            background: #E40046;
            color: #fff;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            transition: 0.3s;
        }

        .btn-package:hover {
            background: #B30037;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center mt-4">Select a Package Category</h1>

    <!-- Category Buttons -->
    <div class="category-buttons">
        <button onclick="loadPackages('Daily Renewal')">Daily Renewal</button>
        <button onclick="loadPackages('Nonstop SD Plans')">Nonstop SD Plans</button>
        <button onclick="loadPackages('Anytime Data Plans')">Anytime Data Plans</button>
        <button onclick="loadPackages('Anytime Combo Plans')">Anytime Combo Plans</button>
        <button onclick="loadPackages('Work & Learn')">Work & Learn</button>
        <button onclick="loadPackages('Work From Home')">Work From Home</button>
        <button onclick="loadPackages('Social Media')">Social Media</button>
        <button onclick="loadPackages('Streaming')">Streaming</button>
    </div>

    <!-- Package Cards -->
    <section class="packages-section py-5">
        <div class="container">
            <div class="row" id="packageList">
                <!-- Cards will be inserted here -->
                <div id="placeholderContent" class="text-center">
                    <img src="assets/img/hero-carousel-1.jpg" width="1000px" alt="Select a category" class="mb-4">
                    <h4 class="text-muted">Select a category to explore available packages</h4>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function loadPackages(category) {
        let authToken = localStorage.getItem("authToken");

        if (!authToken) {
            Swal.fire({
                icon: 'error',
                title: 'Unauthorized Access',
                text: 'Please log in to view packages',
                confirmButtonText: 'Go to Login',
                confirmButtonColor: '#0a7567'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "login.html";
                }
            });
            return;
        }

        // Show loading indicator
        Swal.fire({
            title: 'Loading Packages',
            html: 'Please wait while we fetch available packages...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        $.ajax({
            url: `http://localhost:8080/api/v1/packages/getByType/${encodeURIComponent(category)}`,
            type: "GET",
            headers: { "Authorization": `Bearer ${authToken}` },
            success: function (response) {
                Swal.close(); // Close loading indicator

                $("#packageList").empty(); // Clear previous content
                if (!Array.isArray(response.data) || response.data.length === 0) {
                    Swal.fire({
                        icon: 'info',
                        title: 'No Packages Found',
                        text: 'There are no packages available for this category',
                        confirmButtonColor: '#0a7567'
                    });
                    $("#packageList").html('<div class="text-center text-muted">No packages found for this category.</div>');
                    return;
                }

                response.data.forEach(pkg => {
                    $("#packageList").append(`
                        <div class="col-md-4 mb-4">
                            <div class="package-card">
                                <div class="package-title">${pkg.packageName.toUpperCase()}</div>
                                <div class="package-price">Rs. ${pkg.price.toFixed(2)}</div>
                                <p class="text-muted">Per Month (Tax applicable)</p>
                                <h5 class="mt-3">Unlimited</h5>
                                <small class="text-muted">AnyNet Voice</small>
                                <ul class="package-features">
                                    <li>ðŸ“© ${pkg.smsLimit || 1000} SMS</li>
                                    <li>ðŸ“¶ ${pkg.dataLimit ?? 'N/A'} GB With Data Rollover</li>
                                </ul>
                                <div class="promo-badge">ðŸ”¥ Special promotion</div>
                                <button class="btn btn-package w-100 mt-3" onclick="confirmPackageActivation('${pkg.packageId}', ${pkg.price}, '${pkg.packageName}')">GET PACKAGE</button>
                            </div>
                        </div>
                    `);
                });
            },
            error: function (xhr) {
                Swal.close(); // Close loading indicator

                let errorMsg = "Failed to fetch packages. Please try again later.";
                if (xhr.status === 401) {
                    errorMsg = "Your session has expired. Please log in again.";
                } else if (xhr.status === 403) {
                    errorMsg = "You don't have permission to view these packages.";
                }

                Swal.fire({
                    icon: 'error',
                    title: 'Error Loading Packages',
                    text: errorMsg,
                    confirmButtonColor: '#0a7567'
                }).then((result) => {
                    if (xhr.status === 401 && result.isConfirmed) {
                        window.location.href = "login.html";
                    }
                });
            }
        });
    }

    function confirmPackageActivation(packageId, price, packageName) {
        Swal.fire({
            title: 'Confirm Package Activation',
            html: `You are about to activate <b>${packageName}</b> for <b>Rs. ${price.toFixed(2)}</b>.<br>Do you want to proceed?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#0a7567',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, activate it!',
            cancelButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                activatePackage(packageId, price);
            }
        });
    }

    function activatePackage(packageId, price) {
        Swal.fire({
            title: 'Activating Package',
            html: 'Please wait while we process your request...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        // Simulate activation delay (replace with actual API call)
        setTimeout(() => {
            Swal.fire({
                icon: 'success',
                title: 'Package Activated!',
                text: 'Your package has been successfully activated.',
                confirmButtonColor: '#0a7567'
            }).then(() => {
                window.location.href = `getPackage.html?packageId=${packageId}&price=${price}`;
            });
        }, 1500);
    }
</script>

</body>
</html>