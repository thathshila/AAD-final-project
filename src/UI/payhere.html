<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Checkout</h3>
                </div>
                <div class="card-body">
                    <form id="payment-form" action="https://sandbox.payhere.lk/pay/checkout" method="post">
                        <!-- PayHere Required Parameters -->
                        <input type="hidden" name="merchant_id" id="merchant_id">
                        <input type="hidden" name="return_url" id="return_url">
                        <input type="hidden" name="cancel_url" id="cancel_url">
                        <input type="hidden" name="notify_url" id="notify_url">
                        <input type="hidden" name="order_id" id="order_id">
                        <input type="hidden" name="items" value="Order Payment">
                        <input type="hidden" name="currency" id="currency">
                        <input type="hidden" name="hash" id="hash">

                        <!-- Order Details -->
                        <div class="mb-3">
                            <label class="form-label">Order ID</label>
                            <input type="text" class="form-control" id="display_order_id" disabled>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <input type="text" class="form-control" id="amount" name="amount">
                        </div>

                        <!-- Customer Details -->
                        <h5 class="mt-4">Customer Information</h5>
                        <div class="mb-3">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" name="first_name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" name="last_name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" name="phone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-control" name="address" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">City</label>
                            <input type="text" class="form-control" name="city" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Country</label>
                            <input type="text" class="form-control" name="country" value="Sri Lanka" required>
                        </div>

                        <button type="submit" class="btn btn-success btn-lg w-100 mt-4">Pay Now</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {

        const orderId = "ORD" + Math.floor(Math.random() * 10000);
        $("#display_order_id").val(orderId);
        $("#order_id").val(orderId);

        $("#amount").on("change", function() {
            const amount = $(this).val();
            if (amount > 0) {
                // Request hash and payment details from backend
                $.ajax({
                    url: "http://localhost:8080/payment/generate-hash",
                    method: "GET",
                    data: {
                        orderId: orderId,
                        amount: amount
                    },
                    success: function(response) {
                        // Set the hash and other required fields
                        $("#hash").val(response.hash);
                        $("#merchant_id").val(response.merchant_id);
                        $("#return_url").val(response.return_url);
                        $("#cancel_url").val(response.cancel_url);
                        $("#notify_url").val(response.notify_url);
                        $("#currency").val(response.currency);
                    },
                    error: function(error) {
                        console.error("Error generating hash:", error);
                        alert("Error preparing payment. Please try again.");
                    }
                });
            }
        });
    });
</script>
</body>
</html>